{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/codex-fence/boundary-object-v1",
  "title": "Codex Fence Boundary Object v1",
  "description": "Record of a single probe execution aligned with the capability map.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema_version",
    "stack",
    "probe",
    "run",
    "operation",
    "result",
    "payload"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "bo-v1"
    },
    "stack": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "codex_cli_version",
        "codex_profile",
        "codex_model",
        "sandbox_mode",
        "os",
        "container_tag"
      ],
      "properties": {
        "codex_cli_version": {"type": ["string", "null"]},
        "codex_profile": {"type": ["string", "null"]},
        "codex_model": {"type": ["string", "null"]},
        "sandbox_mode": {
          "type": ["string", "null"],
          "enum": ["read-only", "workspace-write", "danger-full-access", null]
        },
        "os": {"type": "string"},
        "container_tag": {"type": "string"}
      }
    },
    "probe": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id",
        "version",
        "primary_capability_id",
        "secondary_capability_ids"
      ],
      "properties": {
        "id": {"type": "string"},
        "version": {"type": "string"},
        "primary_capability_id": {"type": "string"},
        "secondary_capability_ids": {
          "type": "array",
          "items": {"type": "string"},
          "uniqueItems": true
        }
      }
    },
    "run": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "mode",
        "workspace_root",
        "command",
        "observed_at"
      ],
      "properties": {
        "mode": {
          "type": "string",
          "enum": ["baseline", "codex-sandbox", "codex-full"]
        },
        "workspace_root": {"type": ["string", "null"]},
        "command": {"type": "string"},
        "observed_at": {
          "type": "string",
          "format": "date-time"
        }
      }
    },
    "operation": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "category",
        "verb",
        "target",
        "args"
      ],
      "properties": {
        "category": {"type": "string"},
        "verb": {"type": "string"},
        "target": {"type": "string"},
        "args": {
          "type": "object"
        }
      }
    },
    "result": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "observed_result",
        "raw_exit_code",
        "errno",
        "message",
        "duration_ms",
        "error_detail"
      ],
      "properties": {
        "observed_result": {
          "type": "string",
          "enum": ["success", "denied", "partial", "error"]
        },
        "raw_exit_code": {"type": ["integer", "null"]},
        "errno": {"type": ["string", "null"]},
        "message": {"type": ["string", "null"]},
        "duration_ms": {"type": ["integer", "null"]},
        "error_detail": {"type": ["string", "null"]}
      }
    },
    "payload": {
      "type": "object",
      "additionalProperties": false,
      "required": ["stdout_snippet", "stderr_snippet", "raw"],
      "properties": {
        "stdout_snippet": {"type": ["string", "null"]},
        "stderr_snippet": {"type": ["string", "null"]},
        "raw": {"type": "object"}
      }
    }
  }
}

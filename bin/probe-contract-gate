#!/usr/bin/env bash
set -euo pipefail

# Probe contract gate wrapper: delegates to tools/validate_contract_gate.sh.

script_dir=$(cd "$(dirname "${BASH_SOURCE[0]}")" >/dev/null 2>&1 && pwd)
repo_root=$(cd "${script_dir}/.." >/dev/null 2>&1 && pwd)
validator="${repo_root}/tools/validate_contract_gate.sh"

if [[ ! -x "${validator}" ]]; then
  echo "probe-contract-gate: validator missing at ${validator}" >&2
  exit 1
fi

if [[ $# -ne 1 ]]; then
  cat <<'USAGE' >&2
Usage: bin/probe-contract-gate <probe-id|probes/path/to/probe.sh>

Runs the static probe contract gate followed by the dynamic emit-record gate
for the specified probe across the supported run modes.
USAGE
  exit 1
fi

exec "${validator}" --probe "$1"
